# 其乐论坛解析器插件

## 功能

- 自动解析其乐论坛 (keylol.com) 的链接
- 提取帖子标题、作者、发布时间、内容摘要
- 支持解析帖子中的图片（过滤广告图片）
- 支持配置 Cookies 以访问需要登录的内容
- 支持代理设置
- 使用 PIL 实现的通用媒体卡片渲染
- 将渲染好的图片发送至群里

## 安装

1. 将本插件目录 `keylol-parser` 复制到 AstrBot 的插件目录中
2. 安装依赖：
   ```bash
   pip install -r requirements.txt
   ```
3. 重启 AstrBot 即可启用

## 配置

在 AstrBot 的插件配置面板中，您可以修改以下配置：

- **通用超时时间**：请求超时时间（秒）
- **下载重试次数**：下载失败时的重试次数
- **代理地址**：HTTP 代理地址，例如 http://127.0.0.1:7890
- **转发阈值**：消息段数量达到此值时强制合并转发
- **显示下载失败提示**：当媒体下载失败时是否显示提示
- **单一重媒体时渲染卡片**：当只有一个重媒体时是否渲染卡片
- **缓存目录**：缓存文件保存目录
- **其乐论坛**：
  - **启用**：是否启用其乐论坛解析
  - **使用代理**：是否使用代理访问其乐论坛
  - **Cookies**：其乐论坛的 Cookies，用于访问需要登录的内容

## 用法

在聊天中发送包含其乐论坛链接的消息，例如：
```
https://keylol.com/t1028242-1-1
https://keylol.com/t1028267-1-1
```

插件会自动解析并返回渲染好的媒体卡片。

## 示例

发送消息：
```
https://keylol.com/t1028242-1-1
```

插件会返回：
- 一张包含帖子标题、作者、发布时间、内容摘要和图片的渲染卡片

## 依赖

- nonebot2
- nonebot-adapter-cqhttp
- aiohttp
- beautifulsoup4
- lxml
- pydantic
- pydantic-settings
- python-dotenv
- Pillow
